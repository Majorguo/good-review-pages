<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>好评展示</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin: 0;
    padding: 10px;
    background: #f9f9f9;
  }

  h1 {
    text-align: center;
    margin-bottom: 15px;
  }

  .review-section {
    max-width: 600px;
    margin: 0 auto 20px auto;
  }

  .review-section h2 {
    margin-bottom: 10px;
    font-size: 18px;
  }

  .review-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 300px; /* 超出滚动 */
    overflow-y: auto;
  }

  .review-item {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .review-text {
    width: 100%;
    min-height: 50px;
    padding: 8px;
    border: none;
    background: transparent;
    resize: none;
    font-size: 14px;
    line-height: 1.5;
    color: #333;
    user-select: text;
    -webkit-user-select: text;
    outline: none;
  }

  .review-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .review-buttons button {
    padding: 6px 14px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: #f2f2f2;
    cursor: pointer;
  }

  .review-buttons button:active {
    background: #e0e0e0;
  }
</style>
</head>
<body>

<h1>好评展示</h1>

<div class="review-section" id="section-film">
  <h2>手机贴膜好评</h2>
  <div class="review-list" id="list-film">加载中...</div>
</div>

<div class="review-section" id="section-battery">
  <h2>更换电池好评</h2>
  <div class="review-list" id="list-battery">加载中...</div>
</div>

<script>
async function loadReviews() {
  try {
    const res = await fetch('/api/list');
    const grouped = await res.json();

    renderList('list-film', grouped.膜 || []);
    renderList('list-battery', grouped.电池 || []);

  } catch(e) {
    document.getElementById('list-film').innerHTML = '加载失败：' + e.message;
    document.getElementById('list-battery').innerHTML = '加载失败：' + e.message;
  }
}

function renderList(containerId, reviews) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';

  if (!reviews.length) {
    container.innerHTML = '<p>暂无好评</p>';
    return;
  }

  // 显示最新三条
  reviews.slice(0,3).forEach(item => {
    const div = document.createElement('div');
    div.className = 'review-item';
    div.innerHTML = `
      <textarea class="review-text" readonly>${item.content}</textarea>
      <div class="review-buttons">
        <button onclick="copyReview('${encodeURIComponent(item.content)}')">复制</button>
        <button onclick="deleteReview('${item.id}')">删除</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// 点击复制
function copyReview(content) {
  const text = decodeURIComponent(content);
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => showToast('已复制')).catch(() => fallbackCopy(text));
  } else {
    fallbackCopy(text);
  }
}

// 兜底复制
function fallbackCopy(text) {
  const temp = document.createElement('textarea');
  temp.value = text;
  document.body.appendChild(temp);
  temp.select();
  document.execCommand('copy');
  document.body.removeChild(temp);
  showToast('已复制');
}

// 删除
async function deleteReview(id) {
  try {
    const res = await fetch('/api/delete', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({id})
    });
    const data = await res.json();
    if(res.ok) loadReviews();
    else alert('删除失败：' + (data.error || data.message));
  } catch(e) {
    alert('删除失败：' + e.message);
  }
}

// 轻提示
function showToast(text) {
  const toast = document.createElement('div');
  toast.innerText = text;
  toast.style.cssText = `
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 9999;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 1500);
}

// 页面加载
loadReviews();
</script>

</body>
</html>
